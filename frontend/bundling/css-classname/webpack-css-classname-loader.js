const getOptions = require('../webpack/loader-utils/getOptions');
const modifyCss = require('./css-utils/modifyCss');
const isExcluded = require('./common-utils/isExcluded');
const hashMap = require('./common-utils/hashMap');
const getModuleName = require('./common-utils/getModuleName');


module.exports = function (source) {
    const options = getOptions(this);

    if (isExcluded(this.resourcePath, options)) {
        return source;
    }

    const contextModuleName = getModuleName(this.resourcePath, options);
    const hashClass = hashMap.getValue(this.resourcePath, options);

    return modifyCss(source, {
        classPrefix: options.classPrefix,
        moduleClassPrefix: options.moduleClassPrefix,
        globalClass: options.globalClass,
        hashClass: hashClass,
        contextModuleName: contextModuleName,
    });
}
