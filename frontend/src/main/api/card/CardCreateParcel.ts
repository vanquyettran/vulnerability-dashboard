import AbstractParcel from "../AbstractParcel";
import ResponseResult from 'libs/http-request/ResponseResult';
import ResponseError from 'libs/http-request/ResponseError';
import ICard from 'main/models/interfaces/ICard';
import validateCard from 'main/models/validation/validateCard';

export default class CardCreateParcel extends AbstractParcel<ICard> {
    private readonly listId: string;

    constructor(card: ICard) {
        super();

        this.listId = card.listId;

        this.setRequestMethod('POST');
        this.setEndpoint(`api/list/${card.listId}/card`);
        this.setRequestHeader('Content-Type', 'application/json');
        this.setRequestBody(JSON.stringify({
            text: card.text,
            note: card.note,
        }));

        this.setPayloadValidationMessage(validateCard(card));
        this.setMockResponseData({...card, id: new Date().toISOString()});
    }

    parseResponseError(response: any, xhr: XMLHttpRequest) {
        return new ResponseError(response?.message, xhr.status);
    }

    parseResponseResult(response: any) {
        return new ResponseResult({
            id: response.id,
            text: response.text,
            note: response.note,
            listId: this.listId,
            activityLog: [],
        });
    }
}
