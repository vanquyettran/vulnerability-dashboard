import React from 'react';
import {render, waitFor} from '@testing-library/react';
import DashboardApp from './DashboardApp';
import __ from 'main/i18n';
import TestProvider from 'main/TestProvider';
import Request from 'libs/http-request/Request';
import createDraftRepo from 'main/models/factory/createDraftRepo';

describe('<DashboardApp/>', () => {
    const myRender = () => {
        const screen = render(
            <TestProvider>
                <DashboardApp/>
            </TestProvider>,
        );

        return {screen};
    };

    it('renders title', () => {
        const {screen} = myRender();
        const title = screen.getByText(__('Your repos'));
        expect(title).toBeInTheDocument();
    });

    it('renders repos', async () => {
        Request.setTestMockQueue([
            createDraftRepo({id: 'a', name: 'Saturn'}),
            createDraftRepo({id: 'b', name: 'Mercury'}),
            createDraftRepo({id: 'c', name: 'Earth'}),
        ]);

        const {screen} = myRender();

        await waitFor(() => {
            expect(screen.getByText('Saturn')).toBeInTheDocument();
            expect(screen.getByText('Mercury')).toBeInTheDocument();
            expect(screen.getByText('Earth')).toBeInTheDocument();
        });
    });
});
