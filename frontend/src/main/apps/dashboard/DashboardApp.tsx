import './DashboardApp.less';
import React, {useEffect} from 'react';
import RepoListParcel from 'main/api/repo/RepoListParcel';
import Spinner from 'uikit/components/spinner/Spinner';
import NoticeBox from 'uikit/components/notice-box/NoticeBox';
import __ from 'main/i18n';
import Request from 'libs/http-request/Request';
import useRepoActions from 'main/store/repo/useRepoActions';
import useRepoData from 'main/store/repo/useRepoData';
import RepoGrid from 'main/apps/dashboard/repo-grid/RepoGrid';

export default function DashboardApp() {
    const repoActions = useRepoActions();
    const repoData = useRepoData();

    useEffect(() => {
        const parcel = new RepoListParcel();
        repoActions.ajaxList.run(parcel);

        return () => {
            Request.destroy(parcel);
        };
    }, []);

    const repos = repoData.entities;
    const {inProgress, error} = repoActions.ajaxList.state;

    return (
        <div className="DashboardApp">
            <div className="heading">
                <h1 className="title">{__('Your repos')}</h1>
                {inProgress && (
                    <Spinner/>
                )}
            </div>
            {error !== null && (
                <NoticeBox
                    type="error"
                    message={error.message}
                />
            )}
            {repos.length > 0 && (
                <RepoGrid repos={repos}/>
            )}
        </div>
    );
}
