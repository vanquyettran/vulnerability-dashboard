import './DashboardApp.less';
import React, {useEffect} from 'react';
import RepoListParcel from 'main/api/repo/RepoListParcel';
import Spinner from 'uikit/components/spinner/Spinner';
import NoticeBox from 'uikit/components/notice-box/NoticeBox';
import __ from 'main/i18n';
import RepoList from './repo-list/RepoList';
import Request from 'libs/http-request/Request';
import RepoCreateButton from './repo-create-button/RepoCreateButton';
import useRepoActions from 'main/store/useRepoActions';
import useRepoData from 'main/store/useRepoData';

export default function DashboardApp() {

    const repoMani = useRepoActions();
    const repoData = useRepoData();

    useEffect(() => {
        const parcel = new RepoListParcel();
        repoMani.ajaxList.run(parcel);

        return () => {
            Request.destroy(parcel);
        };
    }, []);

    const repos = repoData.entities;
    const {inProgress, error} = repoMani.ajaxList.state;

    console.log('re-render');

    return (
        <div className="DashboardApp">
            <div className="heading">
                <h2 className="title">{__('Your repos')}</h2>
                {
                    inProgress &&
                    <Spinner/>
                }
            </div>
            {
                error !== null &&
                <NoticeBox
                    type="error"
                    message={error.message}
                />
            }
            {
                repos.length > 0 &&
                <RepoList repos={repos}/>
            }
            <RepoCreateButton/>
        </div>
    );
}
