import './DashboardApp.less';
import React, {useEffect} from 'react';
import RepoListParcel from 'main/api/repo/RepoListParcel';
import NoticeBox from 'uikit/components/notice-box/NoticeBox';
import __ from 'main/i18n';
import Request from 'libs/http-request/Request';
import useRepoActions from 'main/store/repo/useRepoActions';
import useRepoData from 'main/store/repo/useRepoData';
import RepoGrid from 'main/apps/dashboard/repo-grid/RepoGrid';
import AppHeading from 'main/components/app-heading/AppHeading';

export default function DashboardApp() {
    const repoActions = useRepoActions();
    const repoData = useRepoData();

    useEffect(() => {
        const parcel = new RepoListParcel();
        repoActions.ajaxList.run(parcel);

        return () => {
            Request.abandon(parcel);
        };
    }, []);

    const repos = repoData.entities;
    const {inProgress, error} = repoActions.ajaxList.state;

    return (
        <div className="DashboardApp">
            <AppHeading
                title={__('Your repos')}
                description={__('Click on repo names to view and manage their vulnerabilities')}
                inProgress={inProgress}
            />
            {error !== null && (
                <NoticeBox
                    type="error"
                    message={error.message}
                />
            )}
            {repos.length > 0 && (
                <RepoGrid repos={repos}/>
            )}
        </div>
    );
}
