import './RepoDeleteButton.less';
import React, {useEffect, useMemo, useState} from 'react';
import {useRepoStore} from 'main/recoil/hooks';
import Icon from 'uikit/components/icon/Icon';
import ConfirmationDialog from 'uikit/components/confirmation-dialog/ConfirmationDialog';
import IRepo from 'main/interfaces/IRepo';
import RepoDeleteParcel from 'main/api/repo/RepoDeleteParcel';
import Request from 'libs/http-request/Request';
import Popup from 'uikit/components/popup/Popup';
import __ from 'main/i18n';

export default function RepoDeleteButton({repo}: { repo: IRepo }) {

    const repoStore = useRepoStore();

    const [showsConfirmation, setShowsConfirmation] = useState(false);

    const parcel = useMemo(() => new RepoDeleteParcel(repo), [repo]);

    useEffect(() => {
        return () => {
            Request.destroy(parcel);
        };
    }, []);

    return (
        <>
            <button
                className="RepoDeleteButton"
                onClick={() => {
                    setShowsConfirmation(true);
                }}
            >
                <Icon name="trash"/>
            </button>
            {showsConfirmation && (
                <Popup>
                    <ConfirmationDialog
                        confirm={() => {
                            repoStore.ajaxRemove.run(parcel);
                        }}
                        cancel={() => {
                            setShowsConfirmation(false);
                        }}
                        title={__('Delete repo ::name', {name: repo.name})}
                        message={__('Are you sure you want to remove this repo? This action cannot be undone.')}
                    />
                </Popup>
            )}
        </>
    );
}
