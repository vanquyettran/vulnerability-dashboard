import React from 'react';
import {render} from '@testing-library/react';
import __ from 'main/i18n';
import userEvent from '@testing-library/user-event/dist';
import RepoView from './RepoView';
import createDraftRepo from 'main/models/factory/createDraftRepo';
import {AppProvider} from 'main/App';

describe('<RepoView/>', () => {
    const myRender = () => {
        const repo = createDraftRepo({id: 'my-repo', name: 'Hello world!!!'});
        const setIsEditing = jest.fn();

        const screen = render(
            <AppProvider>
                <RepoView
                    repo={repo}
                    setIsEditing={setIsEditing}
                />,
            </AppProvider>
        );

        return {screen, repo, setIsEditing};
    };

    it('renders repo name', () => {
        const {screen, repo} = myRender();
        const textEl = screen.getByText(repo.name);
        expect(textEl).toBeInTheDocument();
    });

    it('clicks edit button', () => {
        const {screen, setIsEditing} = myRender();

        const button = screen.getByTitle(__('Edit'));
        expect(button).toBeInTheDocument();

        userEvent.click(button);

        expect(setIsEditing).toBeCalled();
    });
});
