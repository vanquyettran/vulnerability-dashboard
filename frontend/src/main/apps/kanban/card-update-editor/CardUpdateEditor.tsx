import './CardUpdateEditor.less';
import React, {useEffect, useMemo, useState} from 'react';
import ICard from 'main/models/interfaces/ICard';
import CardUpdateParcel from 'main/api/card/CardUpdateParcel';
import useCardStore from 'main/recoil/useCardStore';
import Request from 'libs/http-request/Request';
import CardForm from '../card-form/CardForm';

export default function CardUpdateEditor({card, onSuccess}: { card: ICard, onSuccess?: (card: ICard) => void }) {

    const cardStore = useCardStore();

    const [draftCard, setDraftCard] = useState({...card});

    const parcel = useMemo(() => {
        return new CardUpdateParcel(draftCard);
    }, [draftCard]);

    useEffect(() => {
        return () => {
            Request.destroy(parcel);
        };
    }, [parcel]);

    return (
        <div className="CardUpdateEditor">
            <CardForm
                action={cardStore.ajaxUpdate}
                parcel={parcel}
                values={draftCard}
                setValues={setDraftCard}
                onSuccess={onSuccess}
            />
        </div>
    );
}
