import './CardCreateEditor.less';
import React, {useEffect, useMemo, useState} from 'react';
import Request from 'libs/http-request/Request';
import CardCreateParcel from 'main/api/card/CardCreateParcel';
import CardForm from '../card-form/CardForm';
import createDraftCard from 'main/models/factory/createDraftCard';
import ICard from 'main/models/interfaces/ICard';
import IList from 'main/models/interfaces/IList';
import useCardActions from 'main/store/card/useCardActions';

export default function CardCreateEditor(
    {
        listId,
        onSuccess,
        onCancel,
    }: {
        listId: IList['id'],
        onSuccess?: (card: ICard) => void
        onCancel?: () => void
    },
) {
    const cardActions = useCardActions();

    const [draftCard, setDraftCard] = useState(createDraftCard({listId}));

    const parcel = useMemo(() => {
        return new CardCreateParcel(listId, draftCard);
    }, [listId, draftCard]);

    useEffect(() => {
        return () => {
            Request.destroy(parcel);
        };
    }, [parcel]);

    return (
        <div className="CardCreateEditor">
            <CardForm
                action={cardActions.ajaxCreate}
                parcel={parcel}
                values={draftCard}
                setValues={setDraftCard}
                onSuccess={onSuccess}
                onCancel={onCancel}
            />
        </div>
    );
}
