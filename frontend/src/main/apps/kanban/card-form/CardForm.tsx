import './CardForm.less';
import React from 'react';
import __ from 'main/i18n';
import {AjaxAction} from 'main/store/interfaces';
import ICard from 'main/models/interfaces/ICard';
import Parcel from 'libs/http-request/Parcel';
import TextArea from 'uikit/components/text-area/TextArea';

export default function CardForm(
    {
        values,
        setValues,
        action,
        parcel,
        onSuccess,
        onCancel,
    }: {
        values: ICard,
        setValues: React.Dispatch<React.SetStateAction<ICard>>,
        action: AjaxAction<ICard>,
        parcel: Parcel<ICard>,
        onSuccess?: (card: ICard) => void,
        onCancel?: () => void,
    },
) {
    const {inProgress, error} = action.state;

    return (
        <form
            className="CardForm"
            onSubmit={(ev) => {
                ev.preventDefault();
                action.run(parcel).then(onSuccess);
            }}
        >
            <TextArea
                value={values.text}
                setValue={text => {
                    setValues({...values, text});
                }}
            />
            {
                error !== null &&
                <div className="error">
                    {error.message}
                </div>
            }
            <div className="actions">
                <button
                    type="submit"
                    disabled={inProgress || values.text.trim().length === 0}
                >
                    {inProgress ? __('Saving...') : __('Save')}
                </button>
                {
                    onCancel !== undefined &&
                    <button
                        type="reset"
                        onClick={() => {
                            onCancel();
                        }}
                        disabled={inProgress}
                    >
                        {__('Cancel')}
                    </button>
                }
            </div>
        </form>
    );
}
