import './Lane.less';
import React, {useEffect} from 'react';
import IList from 'main/models/interfaces/IList';
import {useCardStore} from 'main/recoil/hooks';
import CardListParcel from 'main/api/card/CardListParcel';
import Request from 'libs/http-request/Request';
import Card from 'main/apps/kanban/card/Card';
import CardCreateButton from 'main/apps/kanban/card-create-button/CardCreateButton';

export default function Lane({list}: {list: IList}) {

    const {data, ajaxList} = useCardStore();

    useEffect(() => {
        const parcel = new CardListParcel(list.id);
        ajaxList.run(parcel);

        return () => {
            Request.destroy(parcel);
        };
    }, [list]);

    return (
        <div className="Lane">
            <h3 className="title">
                {list.title}
            </h3>
            <ul>
                {
                    data.allIds.map(id => data.byId[id])
                        .filter(card => card.listId === list.id)
                        .map(card => (
                            <li key={card.id}>
                                <Card card={card}/>
                            </li>
                        ))
                }
            </ul>
            <CardCreateButton listId={list.id}/>
        </div>
    );
}
