# Internationalization

**Internationalization API enables easy localization for target audiences that vary in culture, region, or language.**

## Resources

You can use any data format, but JSON is recommended for better support.
Let's say we put them all inside `i18n/resources` folder.

`i18n/resources/vi.json`

```json
{
  "Hello!": "Xin chào!",
  "What is your name?": "Tên bạn là gì?"
}
```

## Settings

`i18n/index.js`

```js
import {translate, settings} from '../../bootstrap/i18n-core';
import {getCookie, setCookie} from "../../bootstrap/utils/cookie";
import moment from "moment";


settings.setResource('en', Object.assign(
    require('@ccad-ui/i18n/resources/en.json'), // CCAD UI messages
    require('./resources/en.json')              // Your project messages
));

settings.setResource('vi', Object.assign(
    require('@ccad-ui/i18n/resources/vi.json'), // CCAD UI messages
    require('./resources/vi.json')              // Your project messages
));

// The locale of message ID string
settings.setDefaultLocale('en');

// The locale selected by users
settings.setLocale(getCookie('locale', 'vi'));

// Format numbers
settings.setNumberFormatter((number, locale) => {
    return Number(number).toLocaleString(locale);
});

// Format currency values
settings.setCurrencyFormatter((amount, locale, style) => {
    if (style === 'symbol') {
        return translate('::amount ::symbol', {amount, symbol: 'đ'}, locale);
    }

    return translate('::amount ::unit', {amount, unit: 'VND'}, locale);
});

// Format date and time values
settings.setDateFormatter((date, locale, style) => {
    if (style) {
        return moment(date).format(style);
    }

    if (locale === 'en') {
        return moment(date).format('MM/DD/YYYY');
    }

    return moment(date).format('DD/MM/YYYY');
});

/**
 * You can directly use the `translate` function or wrap it by another you like.
 * 
 * @param {string} id
 * @param {Object.<string,string|number|Array>|null?} params
 * @param {string?} locale
 * @return {string}
 */
function __(id, params, locale) {
    return translate(id, params, locale);
}

export default __;
```

## Translate

```js
import __ from 'i18n';

__('Hello!');
// Xin chào

__('Hello!', null, 'en');
// Hello!
```

### Parameterize

In some cases, you must dynamically insert params to strings

**Don't** concat strings manually, different languages have different sentence structures. 

```js
function getMessage(commentCount) {
    return __('Comment count: ') + commentCount;
}
```

**Right way:**

```js
function getMessage(commentCount) {
    return __('Comment count: ::commentCount', {commentCount});
}
```

### Pluralization

Some languages use different forms for singular and plural words.
To handle it, casually you need to write more codes, for instance:

```js
function getMessage(commentCount) {
    if (commentCount === 1) {
        return __('We have a comment');
    }

    return __('We have ::commentCount comments', {commentCount});    
}
```

Now, let's imagine what if we have many plural parameters. You need to handle 2^n cases, impossible!
Fortunately, pluralization feature will make it much simpler for you:

```js
function getMessage(commentCount) {
    return __('We have ::commentCount(PLURAL, 1 a comment, ! :@ comments)', {commentCount});    
}

getMessage(1); // We have a comment
getMessage(5); // We have 5 comments 
```

More complex:

```js
function getMessage(commentCount) {
    return __('There ::commentCount(PLURAL, 1 is, ! are) ::commentCount(PLURAL, 0 no comments, 1 a comment, <10 some comments, <=100 :@ comments, ! 100+ comments)', {commentCount});    
}

getMessage(0);   // There are no comments
getMessage(1);   // There is a comment
getMessage(5);   // There are some comments
getMessage(50);  // There are 50 comments
getMessage(200); // There are 100+ comments
```

### Selection

```js
function greeting(name, gender) {
    return __('Deer ::gender(SELECT, *male* Mr., *female* Ms.) :name!', {gender, name});
}

greeting('Jame', 'male')   // Deer Mr. Jame!
greeting('Mary', 'female') // Deer Ms. Mary!
```

## Escaping

You can escape some text from parameterization or other special processes by wrapping them between square brackets.

```js
__('This car has the power of :power[HP]', {power: 800});
// This car has the power of 800HP

__('I have [:amount]USD', {amount: 100});
// I have :amountUSD

__('There :count(PLURAL, 1 is one comment, >=100 are :@ comments[,] awesome!, ! are :@ comments)', {count: 100});
// There are 100 comments, awesome!

__('Hello:gender(SELECT, *male* [ ]Mr., *female* [ ]Ms., [,]) :name!', {gender: 'other', name: 'Jack'});
// Hello, Jack!
```

## Validator

Validator helps you keep your messages clean and easy to maintain.

```js
const {validator} = require('@ccad-ui/i18n-core/dev');


validator.validateResources();
```

If no errors found, returns:

```json
null
```

If has errors, returns an object contains errors correspond with each ID:

```json
{
    "vi": {
        "message_id": [
            "error 1",
            "error 2"
        ]
    }
}
```

### Validator options:

#### idShouldBeTrimmed

Validate that IDs do not start or end with whitespaces

Type: `boolean`

Default: `true`

```js
validator.setOption('idShouldBeTrimmed', false);
```

#### messageShouldBeTrimmed

Validate that messages do not start or end with whitespaces

Type: `boolean`

Default: `true`

```js
validator.setOption('messageShouldBeTrimmed', false);
```

#### idMaxLength

Validate that IDs do not contain too many characters. Set `null` to disable.

Type: `number|null`

Default: `100`

```js
validator.setOption('idMaxLength', null);
```

#### singleWordMessageMaxLength

Validate that single-word messages do not contain: too many characters. Set `null` to disable.

_(Single-word messages are messages contain only one word, no whitespaces between)._

Type: `number|null`

Default: `20`

```js
validator.setOption('singleWordMessageMaxLength', null);
```

#### idShouldReflectParams

Validate that IDs reflect exactly the same params with corresponding messages.

Type: `boolean`

Default: `true`

```js
validator.setOption('idShouldReflectParams', false);
```

#### isShouldIndicateMessageIsHtmlOrNot

Validate that IDs should start with `</>` if its message contains HTML tags

Type: `boolean`

Default: `true`

```js
validator.setOption('isShouldIndicateMessageIsHtmlOrNot', false);
```


#### idShouldNotBeHtml

Validate that IDs should not contain HTML tags

Type: `boolean`

Default: `true`

```js
validator.setOption('idShouldNotBeHtml', false);
```

## Collector

Collector helps you collect messages from your project automatically as well as remove unused messages. 

```js
const {collector} = require('@ccad-ui/i18n-core/dev');
const path = require('path');


collector.collect(
    path.resolve(__dirname, 'src/i18n/resources'), // path to resource folder
    path.resolve(__dirname, 'src/main'),           // path to consumer folder
    {
        fnNames: ['translate', '__']               // function names to collect
    }
);

```
